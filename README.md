# Clawer-doubanAlbum
This crawler is a multiprocess crawler. Every page will create its own process to access whole downloading process.
这是一个多进程的爬虫，通过进程池在相册查找时按页创建进程，和在进入相册后查找每一页的照片时也是由进程池按页创建进程，可以大大加速查找和下载过程。

## Problem 遇到的问题
由于豆瓣有反爬虫机制，对于不带Cookie的访问频率有限制，查了一下资料，网上说是白天限制每分钟访问40次，夜晚100次，而我做并行查找的速率远远高于这个频率，所以被封了3个ip，于是我setCookie伪装浏览器以及在每下一张图片的时候延迟1秒的间隔，目前小数据量的情况下尚未被封ip，并且对进程池的最大并行进程数从50降到了5，不知道上千张图片会不会速度太慢，不敢尝试。网上有说设置VPN，固然可以，但是稳定的VPN都要收费的。

#### 多进程间的通信传值 Queue（）
#### 使用进程池 Pool（）控制进程数避免进程数激增导致的阻塞


## doubanLogin.py 是豆瓣登录脚本
基本上是完全伪装浏览器的模式，只是会有碰到验证码的模式，目前的解决办法是，判断当前页是不是有验证码的html，如果是，则把验证码的图片爬下来，存在本地，看了之后手动输入验证。

## multiprocessing 关于多进程
当时考虑了多线程和多进程，并且pyhton官方是推荐使用多进程的，总结了一下原因有以下几点：
1、CPU密集型代码(各种循环处理、计数等等)，在这种情况下，由于计算工作多，ticks计数很快就会达到阈值，然后触发GIL的释放与再竞争（多个线程来回切换当然是需要消耗资源的），所以python下的多线程对CPU密集型代码并不友好。

2、IO密集型代码(文件处理、网络爬虫等)，多线程能够有效提升效率(单线程下有IO操作会进行IO等待，造成不必要的时间浪费，而开启多线程能在线程A等待时，自动切换到线程B，可以不浪费CPU的资源，从而能提升程序执行效率)。所以python的多线程对IO密集型代码比较友好。

#####注意：
但是这仅限于单核处理器，对于多核处理器。多核多线程比单核多线程更差，原因是单核下多线程，每次释放GIL，唤醒的那个线程都能获取到GIL锁，所以能够无缝执行，但多核下，CPU0释放GIL后，其他CPU上的线程都会进行竞争，但GIL可能会马上又被CPU0拿到，导致其他几个CPU上被唤醒后的线程会醒着等待到切换时间后又进入待调度状态，这样会造成线程颠簸(thrashing)，导致效率更低

#####“python下想要充分利用多核CPU，就用多进程”

原因是：每个进程有各自独立的GIL，互不干扰，这样就可以真正意义上的并行执行，所以在python中，多进程的执行效率优于多线程(仅仅针对多核CPU而言)。

所以在这里说结论：多核下，想做并行提升效率，比较通用的方法是使用多进程，能够有效提高执行效率


